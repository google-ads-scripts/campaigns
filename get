
function main() {

var SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/18Clpx9T5t_eWW8Z2t89bQu8mauXcaGzpku1B2tCujLk/edit';
var ss = SpreadsheetApp.openByUrl(SPREADSHEET_URL);
var sheet = ss.getSheetByName("Today");
var reportSheet = ss.getSheetByName("Formulas");
var date = new Date();
//var statusSheet = ss.getSheetByName("Status"); 
//statusSheet.getRange(3,2).setValue('Currently Updating')
//statusSheet.getRange(4,2).setValue('Not Complete')
// Get ACCOUNTS
  
reportSheet.getRange(2,7).setValue("Currently Updating")
reportSheet.getRange(4,7).setValue("No")

sheet.clear();

var columns = ['Account','Campaign','AdGroup','Keyword','Keyword ID','Keyword Status','Match Type','Max.CPC','Impr','Clicks','Cost','Reg'];   
sheet.appendRow(columns);
  
var accountIterator = AdsManagerApp.accounts()
 .withCondition("Cost > 0")
 .forDateRange("TODAY")
 .orderBy("Clicks DESC")
 .get();

  // Iterate through the ACCOUNTS
//var accountIterator = accountSelector.get();  
 var array = []
while (accountIterator.hasNext()) {
var account = accountIterator.next();
AdsManagerApp.select(account)

    
var report = AdsApp.report(
 'SELECT AccountDescriptiveName, CampaignName,AdGroupName,Criteria,KeywordMatchType,Status,Id,CpcBid,Impressions, Clicks,Cost,Conversions ' +
 'FROM KEYWORDS_PERFORMANCE_REPORT ' +
 'WHERE Cost > 0 ' +
 'DURING TODAY');
  
  
var rows = report.rows();

while(rows.hasNext()) {
  var row = rows.next().formatForUpload(report);
  //Logger.log(row)
 
   if(row.Keyword.indexOf("+")>=0){
     array.push([row.Account,row.Campaign,row["Ad group"],"'"+ row.Keyword,row["Keyword ID"],row["Keyword state"],row["Match type"],row["Max. CPC"],row.Impressions,row.Clicks,row.Cost,row["Conv. (opt.)"]])
     
   } else{
     array.push([row.Account,row.Campaign,row["Ad group"],row.Keyword,row["Keyword ID"],row["Keyword state"],row["Match type"],row["Max. CPC"],row.Impressions,row.Clicks,row.Cost,row["Conv. (opt.)"]])
      
    }
  }  
  sheet.getRange(2,1,array.length,array[0].length).setValues(array)
}
  //statusSheet.getRange(3,2).setValue('Updated on ' + date)
  
  reportSheet.getRange(2,7).setValue(date)
  
  eval(UrlFetchApp.fetch('https://raw.githubusercontent.com/google-ads-scripts/performancereport/keywords/get').getContentText())
  
}
